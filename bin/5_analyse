#!/bin/bash
# 
# Used when doing cross-validation tests, this script is used to create jobs
# for computing the similarity/volume of output segmentations. 
# 
# Specifically, imagine you had run your voting stage like so: 
#  vote.py \
#       --tar_output \
#       --fusion_dir=output\fusion_1  \
#       --random_subsampling  \
#       --num_atlases=1:9:2  \
#       --num_templates=1:15:2  \
#       --majvote  \
#       --xcorr=1:15:2  \
#       --nmi=1:15:2  \
#       --multiatlas  \
#       --multiatlas_xcorr=1:15:2  \
#       --multiatlas_nmi=1:15:2 \
#       subject_1
#
# Then in your fusion_1 output folder you should find a .tar file with the
# results of the various voting permutations. This script will find those .tar
# files, and emit analyse_vote_tar.sh commands to analyse them. 
#
# This script expects output/fusion* folders with .tar files in them. 
#
for i in input/atlases/labels/*.mnc; do
    for t in output/fusion*/*_$(basename $i _labels.mnc).tar; do
        csv=$(dirname $t)/$(basename $t .tar)_similarity.csv
        [ -e $csv ] && continue
        echo vote_tar_analyse.sh $t $i
    done 
done > analyse.jobs
